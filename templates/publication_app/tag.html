{% extends 'base.html' %}

{% block content %}

{% if request.user.is_authenticated %}
<p><a href="{% url 'add_post'%}">Добавить пост</a></p>
<div class="container mt-3">
    <h2>Все тэги:</h2>
    <div class="row">
        <div class="col-md-5">
            <div class="list-group">
                {% for t in tag %}
                <a href="/tags/{{t.tag }}" class="list-group-item list-group-item-action">{{ t.tag}}</a>
                {% endfor %}
            </div>
        </div>
        <div class="col-md">
            <h2>Посты по тэгу {{ name_tag }}:</h2>
            {% for post in posts %}
            <div class="card mb-3">
                <div class="card-header">
                    Пост создал:<b>{{ post.user.username }}</b>
                </div>
                <div class="card-body">
                    <div class="media">
                        {% for img in image %}
                            {% if post.id == img.post_id %}
                                {% if img.image %}
                                    <img src="{{ img.image.url }}" class="mr-3" alt="" width="250px" height="250px" >
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <div class="media-body">
                            <h5 class="card-title">{{ post.title}}</h5>
                            <p class="card-text">{{ post.text}}.</p>
                            <p align="right">Теги:
                            {% for tag in post.tag.all%}
                                {{ tag.tag }},
                            {% endfor%}</p>
                            {% if post.user_id == user.pk %}
                                <p align="right">
                                    <a href="/edit_post/{{post.pk}}"><button type="button" class="btn btn-warning">Редактировать пост</button></a>
                                    <a href="/delete_post/{{post.pk}}"><button type="button" class="btn btn-danger">Удалить пост</button></a>
                                </p>
                            {% endif %}
                            <a href="#" class="btn btn-primary">Открыть пост...</a>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-muted">
                    {{ post.created_time|date:"d M Y H:i" }}
                </div>
            </div>
        {% endfor %}
        </div>
    </div>
</div>
<!--            {{post.id}}-->
<!--            <h4>{{ post.title }}</h4>-->
<!--            <div>-->
<!--            {% for img in image %}-->
<!--                {% if post.id == img.post_id %}-->
<!--                    {% if img.image %}-->
<!--                        <img src="{{ img.image.url }}" alt="" width="250px" height="250px">-->
<!--                    {% endif %}-->
<!--                {% endif %}-->
<!--            {% endfor %}-->
<!--            </div>-->
<!--            <div>{{ post.text }}</div>-->
<!--            <br>-->
<!--            Тэги:-->
<!--            {% for tag in post.tag.all %}-->
<!--                {{ tag.tag }},-->
<!--            {% endfor %}-->
{% else %}
    <h3>Для просмотра данного раздела нужно авторизоваться или зарегистрировать!</h3>
    <p><a href="{% url 'login' %}">Авторизация</a></p>
    <p><a href="{% url 'register' %}">Регистрация</a></p>
{% endif %}

{% endblock %}